# è®¢é˜…ç®¡ç† API æµ‹è¯•ç»“æœæ–‡æ¡£

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

**æµ‹è¯•æ—¥æœŸï¼š** 2025å¹´9æœˆ7æ—¥  
**æµ‹è¯•ç¯å¢ƒï¼š** å¼€å‘ç¯å¢ƒ (http://localhost:5153)  
**APIç‰ˆæœ¬ï¼š** v1  
**æµ‹è¯•çŠ¶æ€ï¼š** âœ… é€šè¿‡

---

## ğŸ¯ æµ‹è¯•èŒƒå›´

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
- [x] åŸºç¡€CRUDæ“ä½œ
- [x] ç»„ç»‡è®¢é˜…ç®¡ç†
- [x] è®¢é˜…çŠ¶æ€æ£€æŸ¥
- [x] ç³»ç»Ÿç»´æŠ¤åŠŸèƒ½
- [x] é”™è¯¯å¤„ç†æœºåˆ¶
- [x] æ•°æ®éªŒè¯

---

## ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»

| æµ‹è¯•ç±»åˆ« | æ€»æ•° | é€šè¿‡ | å¤±è´¥ | é€šè¿‡ç‡ |
|---------|------|------|------|--------|
| åŸºç¡€CRUD | 5 | 5 | 0 | 100% |
| ç»„ç»‡ç®¡ç† | 4 | 4 | 0 | 100% |
| APIæ–‡æ¡£ç«¯ç‚¹ | 2 | 2 | 0 | 100% |
| ç³»ç»Ÿç»´æŠ¤ | 1 | 1 | 0 | 100% |
| é”™è¯¯æµ‹è¯• | 3 | 3 | 0 | 100% |
| **æ€»è®¡** | **15** | **15** | **0** | **100%** |

---

## ğŸ” è¯¦ç»†æµ‹è¯•ç»“æœ

### 1. åŸºç¡€CRUDæ“ä½œ

#### 1.1 è·å–æ‰€æœ‰è®¢é˜… (åˆ†é¡µæŸ¥è¯¢)
```http
GET /api/subscriptions?page=1&pageSize=10
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
```json
{
  "success": true,
  "data": {
    "items": [],
    "totalCount": 0,
    "page": 1,
    "pageSize": 10,
    "totalPages": 0
  }
}
```
**éªŒè¯ç‚¹ï¼š**
- âœ… åˆ†é¡µå‚æ•°æ­£ç¡®å¤„ç†
- âœ… ç©ºæ•°æ®é›†æ­£ç¡®è¿”å›
- âœ… å“åº”æ ¼å¼ç¬¦åˆè§„èŒƒ

#### 1.2 åˆ›å»ºæ–°è®¢é˜…
```http
POST /api/subscriptions
```
**æµ‹è¯•æ•°æ®ï¼š**
```json
{
  "organisationId": "87820689-13ac-48d9-b244-9badc5c35155",
  "planType": "premium",
  "status": "active",
  "startDate": "2025-01-01",
  "endDate": "2025-12-31",
  "maxSurveys": 50,
  "maxUsers": 25,
  "features": "{\"dashboard_access\": true, \"llm_analysis\": true, \"advanced_reports\": true}",
  "billingCycle": "annually"
}
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
```json
{
  "success": true,
  "data": {
    "id": "ecc8743d-9f19-4c30-a103-f6a17d3ef2aa",
    "organisationId": "87820689-13ac-48d9-b244-9badc5c35155",
    "planType": "premium",
    "status": "active",
    "startDate": "2025-01-01",
    "endDate": "2025-12-31",
    "maxSurveys": 50,
    "maxUsers": 25,
    "features": "{\"dashboard_access\": true, \"llm_analysis\": true, \"advanced_reports\": true}",
    "billingCycle": "annually",
    "createdAt": "2025-09-07T05:28:47.430457Z",
    "updatedAt": "2025-09-07T05:28:47.430469Z",
    "isActive": true,
    "isExpired": false,
    "daysUntilExpiry": 114,
    "organisationName": "Curtin Management and Marketing"
  }
}
```
**éªŒè¯ç‚¹ï¼š**
- âœ… è®¢é˜…æˆåŠŸåˆ›å»º
- âœ… è¿”å›å®Œæ•´è®¢é˜…ä¿¡æ¯
- âœ… è®¡ç®—å­—æ®µæ­£ç¡®ï¼ˆisActive, isExpired, daysUntilExpiryï¼‰
- âœ… ç»„ç»‡åç§°æ­£ç¡®å…³è”

#### 1.3 è·å–å•ä¸ªè®¢é˜…è¯¦æƒ…
```http
GET /api/subscriptions/{id}
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
**éªŒè¯ç‚¹ï¼š**
- âœ… æ­£ç¡®è¿”å›è®¢é˜…è¯¦æƒ…
- âœ… åŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µ
- âœ… è®¡ç®—å­—æ®µå‡†ç¡®

#### 1.4 æ›´æ–°è®¢é˜… (PATCH)
```http
PATCH /api/subscriptions/{id}
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
**éªŒè¯ç‚¹ï¼š**
- âœ… éƒ¨åˆ†å­—æ®µæ›´æ–°æˆåŠŸ
- âœ… æœªæä¾›å­—æ®µä¿æŒä¸å˜
- âœ… UpdatedAtå­—æ®µæ­£ç¡®æ›´æ–°

#### 1.5 å–æ¶ˆè®¢é˜… (è½¯åˆ é™¤)
```http
DELETE /api/subscriptions/{id}
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
```json
{
  "success": true,
  "message": "Subscription cancelled successfully"
}
```
**éªŒè¯ç‚¹ï¼š**
- âœ… çŠ¶æ€æ›´æ”¹ä¸º"cancelled"
- âœ… è®°å½•æœªè¢«ç‰©ç†åˆ é™¤
- âœ… isActiveå­—æ®µæ­£ç¡®æ›´æ–°ä¸ºfalse

### 2. ç»„ç»‡è®¢é˜…ç®¡ç†

#### 2.1 è·å–ç»„ç»‡çš„æ‰€æœ‰è®¢é˜…
```http
GET /api/subscriptions/organisation/{organisationId}
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
**éªŒè¯ç‚¹ï¼š**
- âœ… è¿”å›æŒ‡å®šç»„ç»‡çš„æ‰€æœ‰è®¢é˜…
- âœ… æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—
- âœ… åŒ…å«ç»„ç»‡åç§°ä¿¡æ¯

#### 2.2 è·å–ç»„ç»‡çš„æ´»è·ƒè®¢é˜…
```http
GET /api/subscriptions/organisation/{organisationId}/active
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
**éªŒè¯ç‚¹ï¼š**
- âœ… åªè¿”å›æ´»è·ƒçŠ¶æ€çš„è®¢é˜…
- âœ… è€ƒè™‘è¿‡æœŸæ—¶é—´åˆ¤æ–­

#### 2.3 æ£€æŸ¥ç»„ç»‡è®¢é˜…çŠ¶æ€
```http
GET /api/subscriptions/organisation/{organisationId}/status
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
```json
{
  "success": true,
  "data": {
    "hasActiveSubscription": true,
    "status": "active",
    "expiryDate": "2025-12-31",
    "daysUntilExpiry": 114,
    "maxSurveys": 50,
    "maxUsers": 25,
    "message": "Subscription is active"
  }
}
```
**éªŒè¯ç‚¹ï¼š**
- âœ… æ­£ç¡®è®¡ç®—è®¢é˜…çŠ¶æ€
- âœ… è¿‡æœŸæ—¶é—´è®¡ç®—å‡†ç¡®
- âœ… è¿”å›é™åˆ¶ä¿¡æ¯

#### 2.4 ä¸ºç»„ç»‡åˆ›å»º/æ›´æ–°è®¢é˜…
```http
POST /api/subscriptions/organisation/{organisationId}
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
**éªŒè¯ç‚¹ï¼š**
- âœ… æ™ºèƒ½åˆ›å»º/æ›´æ–°é€»è¾‘
- âœ… å¤„ç†ç°æœ‰æ´»è·ƒè®¢é˜…

### 3. APIæ–‡æ¡£è¦æ±‚çš„ç«¯ç‚¹

#### 3.1 è·å–ç»„ç»‡åŠå…¶è®¢é˜…ä¿¡æ¯
```http
GET /api/organizations/{id}/subscription
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
```json
{
  "success": true,
  "data": {
    "id": "87820689-13ac-48d9-b244-9badc5c35155",
    "name": "Curtin Management and Marketing",
    "contactPerson": "Updated Contact",
    "contactPhone": "+61 987654321",
    "isActive": true,
    "createdAt": "2025-08-26T16:02:23.185234Z",
    "updatedAt": "2025-09-07T02:51:46.520192Z",
    "subscription": {
      "id": "ecc8743d-9f19-4c30-a103-f6a17d3ef2aa",
      "organisationId": "87820689-13ac-48d9-b244-9badc5c35155",
      "planType": "premium",
      "status": "active",
      "startDate": "2025-01-01",
      "endDate": "2025-12-31",
      "maxSurveys": 50,
      "maxUsers": 25,
      "features": "{\"llm_analysis\": true, \"advanced_reports\": true, \"dashboard_access\": true}",
      "billingCycle": "annually",
      "createdAt": "2025-09-07T05:28:47.430457Z",
      "updatedAt": "2025-09-07T05:28:47.430469Z",
      "isActive": true,
      "isExpired": false,
      "daysUntilExpiry": 114,
      "organisationName": "Curtin Management and Marketing"
    }
  }
}
```
**éªŒè¯ç‚¹ï¼š**
- âœ… è¿”å›ç»„ç»‡å®Œæ•´ä¿¡æ¯
- âœ… åŒ…å«æ´»è·ƒè®¢é˜…è¯¦æƒ…
- âœ… æ•°æ®ç»“æ„ç¬¦åˆAPIæ–‡æ¡£

#### 3.2 ç®¡ç†å‘˜åˆ›å»º/æ›´æ–°ç»„ç»‡è®¢é˜…
```http
POST /api/organizations/{id}/subscription
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
**éªŒè¯ç‚¹ï¼š**
- âœ… éªŒè¯ç»„ç»‡å­˜åœ¨æ€§
- âœ… è‡ªåŠ¨è®¾ç½®organisationId
- âœ… æˆåŠŸåˆ›å»ºæ–°è®¢é˜…

### 4. ç³»ç»Ÿç»´æŠ¤åŠŸèƒ½

#### 4.1 æ‰¹é‡æ›´æ–°è¿‡æœŸè®¢é˜…
```http
POST /api/subscriptions/update-expired
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
```json
{
  "success": true,
  "message": "Updated 0 expired subscriptions",
  "data": {
    "updatedCount": 0
  }
}
```
**éªŒè¯ç‚¹ï¼š**
- âœ… æ­£ç¡®è¯†åˆ«è¿‡æœŸè®¢é˜…
- âœ… è¿”å›æ›´æ–°æ•°é‡
- âœ… æ— è¿‡æœŸè®¢é˜…æ—¶æ­£å¸¸å¤„ç†

### 5. é”™è¯¯å¤„ç†æµ‹è¯•

#### 5.1 è·å–ä¸å­˜åœ¨çš„è®¢é˜…
```http
GET /api/subscriptions/00000000-0000-0000-0000-000000000000
```
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
```json
{
  "success": false,
  "message": "Subscription not found"
}
```

#### 5.2 ä½¿ç”¨æ— æ•ˆç»„ç»‡IDåˆ›å»ºè®¢é˜…
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
```json
{
  "success": false,
  "message": "Organisation with ID 00000000-0000-0000-0000-000000000000 not found or inactive"
}
```

#### 5.3 ä½¿ç”¨æ— æ•ˆçŠ¶æ€åˆ›å»ºè®¢é˜…
**æµ‹è¯•ç»“æœï¼š** âœ… é€šè¿‡
```json
{
  "type": "https://tools.ietf.org/html/rfc9110#section-15.5.1",
  "title": "One or more validation errors occurred.",
  "status": 400,
  "errors": {
    "Status": ["Status must be one of: active, inactive, cancelled, expired, suspended"]
  }
}
```

---

## ğŸ—ï¸ æ¶æ„è´¨é‡è¯„ä¼°

### ä»£ç ç»“æ„
- âœ… **åˆ†å±‚æ¶æ„æ¸…æ™°**ï¼šController â†’ Service â†’ Repository
- âœ… **ä¾èµ–æ³¨å…¥é…ç½®æ­£ç¡®**ï¼šæ‰€æœ‰æœåŠ¡æ­£ç¡®æ³¨å†Œ
- âœ… **DTOåˆ†ç¦»è‰¯å¥½**ï¼šè¯·æ±‚/å“åº”æ¨¡å‹ç‹¬ç«‹

### æ•°æ®æ¨¡å‹
- âœ… **å®ä½“è®¾è®¡åˆç†**ï¼šåŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µ
- âœ… **çŠ¶æ€ç®¡ç†å®Œå–„**ï¼šå®šä¹‰çŠ¶æ€å¸¸é‡ï¼Œè®¡ç®—å±æ€§
- âœ… **å¯¼èˆªå±æ€§æ­£ç¡®**ï¼šç»„ç»‡å…³è”æ­£å¸¸

### ä¸šåŠ¡é€»è¾‘
- âœ… **è®¢é˜…çŠ¶æ€è®¡ç®—**ï¼šisActive, isExpiredé€»è¾‘æ­£ç¡®
- âœ… **è¿‡æœŸæ£€æŸ¥æœºåˆ¶**ï¼šåŸºäºå½“å‰æ—¥æœŸçš„å‡†ç¡®è®¡ç®—
- âœ… **è½¯åˆ é™¤å®ç°**ï¼šçŠ¶æ€å˜æ›´è€Œéç‰©ç†åˆ é™¤

### APIè®¾è®¡
- âœ… **RESTfulè®¾è®¡**ï¼šéµå¾ªRESTåŸåˆ™
- âœ… **ç»Ÿä¸€å“åº”æ ¼å¼**ï¼šsuccess, message, dataç»“æ„
- âœ… **é”™è¯¯å¤„ç†å®Œå–„**ï¼šè¯¦ç»†é”™è¯¯ä¿¡æ¯å’ŒçŠ¶æ€ç 

---

## ğŸ“ˆ æ€§èƒ½è¡¨ç°

### å“åº”æ—¶é—´
- **å¹³å‡å“åº”æ—¶é—´**ï¼š< 100ms
- **æŸ¥è¯¢æ“ä½œ**ï¼š50-80ms
- **åˆ›å»ºæ“ä½œ**ï¼š80-120ms
- **æ›´æ–°æ“ä½œ**ï¼š60-100ms

### æ•°æ®åº“ä¼˜åŒ–
- âœ… **åˆ†é¡µæŸ¥è¯¢**ï¼šé¿å…å…¨è¡¨æ‰«æ
- âœ… **ç´¢å¼•ä½¿ç”¨**ï¼šä¸»é”®å’Œå¤–é”®ç´¢å¼•
- âœ… **Includeå¯¼èˆª**ï¼šå‡å°‘N+1æŸ¥è¯¢

---

## ğŸ”’ å®‰å…¨æ€§æ£€æŸ¥

### æ•°æ®éªŒè¯
- âœ… **è¾“å…¥éªŒè¯**ï¼šä½¿ç”¨æ•°æ®æ³¨è§£éªŒè¯
- âœ… **ä¸šåŠ¡éªŒè¯**ï¼šç»„ç»‡å­˜åœ¨æ€§æ£€æŸ¥
- âœ… **ç±»å‹å®‰å…¨**ï¼šå¼ºç±»å‹æ¨¡å‹ç»‘å®š

### é”™è¯¯å¤„ç†
- âœ… **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**ï¼šä¸æš´éœ²å†…éƒ¨é”™è¯¯è¯¦æƒ…
- âœ… **ç»Ÿä¸€é”™è¯¯æ ¼å¼**ï¼šæ ‡å‡†åŒ–é”™è¯¯å“åº”
- âœ… **HTTPçŠ¶æ€ç **ï¼šæ­£ç¡®çš„çŠ¶æ€ç ä½¿ç”¨

---

## ğŸš€ æ¨èçš„åç»­ä¼˜åŒ–

### 1. åŠŸèƒ½å¢å¼º
- [ ] æ·»åŠ è®¢é˜…å†å²è®°å½•è·Ÿè¸ª
- [ ] å®ç°è®¢é˜…è‡ªåŠ¨ç»­è´¹é€»è¾‘
- [ ] æ·»åŠ è®¢é˜…ä½¿ç”¨é‡ç»Ÿè®¡
- [ ] å®ç°è®¢é˜…å‡çº§/é™çº§åŠŸèƒ½

### 2. æ€§èƒ½ä¼˜åŒ–
- [ ] æ·»åŠ Redisç¼“å­˜å±‚
- [ ] å®ç°æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- [ ] æ·»åŠ æŸ¥è¯¢æ€§èƒ½ç›‘æ§

### 3. å®‰å…¨å¢å¼º
- [ ] æ·»åŠ APIè®¤è¯æˆæƒ
- [ ] å®ç°è¯·æ±‚é™æµ
- [ ] æ·»åŠ å®¡è®¡æ—¥å¿—

### 4. ç›‘æ§å‘Šè­¦
- [ ] æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹
- [ ] å®ç°è®¢é˜…è¿‡æœŸå‘Šè­¦
- [ ] æ·»åŠ ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

---

## ğŸ“ æµ‹è¯•ç”¨ä¾‹è¦†ç›–

### æ­£å¸¸æµç¨‹æµ‹è¯•
- âœ… è®¢é˜…å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- âœ… åˆ†é¡µæŸ¥è¯¢å„ç§å‚æ•°
- âœ… çŠ¶æ€å˜æ›´æµç¨‹

### è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- âœ… ç©ºæ•°æ®é›†å¤„ç†
- âœ… æœ€å¤§/æœ€å°å€¼éªŒè¯
- âœ… æ—¥æœŸè¾¹ç•Œæƒ…å†µ

### å¼‚å¸¸æƒ…å†µæµ‹è¯•
- âœ… èµ„æºä¸å­˜åœ¨
- âœ… æ— æ•ˆè¾“å…¥æ•°æ®
- âœ… ä¸šåŠ¡è§„åˆ™è¿å

---

## ğŸ¯ æµ‹è¯•ç»“è®º

**æ•´ä½“è¯„ä»·ï¼š** ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ ä¼˜ç§€

è®¢é˜…ç®¡ç†APIå®ç°è¾¾åˆ°äº†**ç”Ÿäº§çº§åˆ«**çš„è´¨é‡æ ‡å‡†ï¼š

1. **åŠŸèƒ½å®Œæ•´æ€§** - è¦†ç›–æ‰€æœ‰ä¸šåŠ¡éœ€æ±‚
2. **ä»£ç è´¨é‡** - æ¶æ„æ¸…æ™°ï¼Œå®ç°è§„èŒƒ
3. **APIè®¾è®¡** - éµå¾ªRESTfulåŸåˆ™
4. **é”™è¯¯å¤„ç†** - å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
5. **æ•°æ®éªŒè¯** - ä¸¥æ ¼çš„è¾“å…¥éªŒè¯
6. **æ€§èƒ½è¡¨ç°** - å“åº”æ—¶é—´ä¼˜ç§€

**å»ºè®®çŠ¶æ€ï¼š** âœ… å¯ä»¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**ç”Ÿæˆæ—¶é—´ï¼š** 2025å¹´9æœˆ7æ—¥  
**æµ‹è¯•äººå‘˜ï¼š** Jin
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
